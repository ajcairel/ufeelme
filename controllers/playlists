const Playlist = require('../models/playlist');

module.exports = {
    index,
    show,
    new: newPlaylist,
    create, 
    // delete: deletePlaylist
}

// function index(req, res) {
//     // const query = req.query.filter ? {streamingService: req.query.filter} : {};
//     const query = req.query.filter;
//     // const playlists = Playlist.find(query);
//     const playlists = Playlist.find({});

//     console.log('index loading');
//     console.log('playlists' + playlists);
//     res.render('playlists/index', {query, playlists});
// }

// function deletePlaylist(req, res) {
//     Playlist.
//     Playlist.findOne({'reviews._id': req.params.id, 'reviews.user': req.user._id}).then(function(playlist) {
//         // handle rougue user
//         if (!playlist) return res.redirect('/playlists');
//         // Remove the review using the remove method available on arrays in Mongoose
//         playlist.reviews.remove(req.params.id);
//         // Save the updated playlist (review removed)
//         playlist.save().then(function() {
//             // Redirect back to the playlist's show view
//             res.redirect(`/playlists/${playlist._id}`);
//         }).catch(function(err) {
//             // Let express display an error
//             return next(err);
//         });
//     });
// }



    async function index(req, res) {
        // const query = req.query.filter ? {streamingService: req.query.filter} : {};
        const query = req.query.filter;
        // const playlists = Playlist.find(query);
        const playlists = await Playlist.find({});
        if (query === 'Spotify') {
            title = 'Spotify Playlists';
        } else if (query === 'Apple') {
            title = 'Apple Music Playlists';
        } else if (query === 'Sound') {
            title = 'Soundcloud Playlists';
        }
    
        // console.log('index loading');
        // console.log('playlists' + playlists);
        res.render('playlists/index', {title: title, query, playlists});
    }

        // async function index(req, res) {
        //     const query = req.query.filter ? {streamingService: req.query.filter} : {};
        //     const playlists = await Playlist.find(query);
        //     res.render('playlists/index', {query, playlists});
        // }
    


function show(req, res) {
    Playlist.findById(req.params.id, function(err, playlist) {
        res.render('playlists/show', {title: playlist.name, playlist});
    })

}

function newPlaylist(req, res) {
    const service = req.query.filter;
    // console.log('new loading');
    res.render('playlists/new', {title: `Add Playlist`, service});
}


function create(req, res) {
    var playlist = new Playlist(req.body);
    playlist.save(function(err) {
        // if(err) return res.redirect('/playlists/new');
        if (err) return console.log('Error');
        // if (err) return res.redirect('/playlists');
        // console.log("playlist");
        // res.redirect('/playlists/');
        res.redirect(`/playlists/${playlist.id}`);
    });

}





